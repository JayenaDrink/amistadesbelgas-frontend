<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AB — Admin DEBUG (sin filtros)</title>
  <style>
    body{font-family:system-ui,Arial,sans-serif;background:#0f172a;color:#e5e7eb;margin:0;padding:16px}
    .card{background:#111827;border:1px solid #1f2937;border-radius:12px;padding:16px;max-width:1100px;margin:0 auto}
    code{white-space:pre-wrap;word-break:break-word}
    .row{border-top:1px solid #1f2937;padding:8px 0}
    .row:first-child{border-top:0}
    .green{background:rgba(34,197,94,.12);border-radius:8px;padding:6px 8px;display:inline-block}
  </style>
</head>
<body>
  <div class="card">
    <h1>Admin DEBUG — últimos 200 documentos de <code>orders</code></h1>
    <div id="status">Conectando…</div>
    <div id="list"></div>
  </div>

  <script type="module">
    const firebaseConfig = {
  apiKey: "AIzaSyBPNfGVvTJWEim3qgK3rS2PcEaqpej3Dms",
  authDomain: "barbelga-3f021.firebaseapp.com",
  projectId: "barbelga-3f021",
  storageBucket: "barbelga-3f021.firebasestorage.app",
  messagingSenderId: "111939067233",
  appId: "1:111939067233:web:6af08d6f96a22cb38c3920"
};
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getFirestore, collection, onSnapshot, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const statusEl = document.getElementById('status');
    const listEl = document.getElementById('list');

    function fmt(d){
      if(!d) return "--";
      try{
        if(typeof d.toDate === 'function') return d.toDate().toLocaleString();
      }catch(_){}
      if(typeof d === 'string') return new Date(d).toLocaleString();
      if(typeof d === 'number') return new Date(d).toLocaleString();
      return String(d);
    }

    try{
      const qRef = query(collection(db,'orders'), orderBy('createdAt','desc'), limit(200));
      onSnapshot(qRef, (snap)=>{
        statusEl.textContent = `Recibidos ${snap.size} documentos.`;
        listEl.innerHTML = '';
        snap.forEach(docu => {
          const data = docu.data();
          const div = document.createElement('div');
          div.className = 'row';
          div.innerHTML = `
            <div><strong>${data.name||'—'}</strong> — <span class="${data.status==='completed'?'green':''}">${data.status||'?'}</span></div>
            <div>Total: €${(data.total||0).toFixed(2)} — createdAt: ${fmt(data.createdAt)}</div>
            <details><summary>JSON</summary><code>${JSON.stringify(data,null,2)}</code></details>
          `;
          listEl.appendChild(div);
        });
      }, (err)=>{
        statusEl.textContent = 'Error: ' + err.message;
        console.error(err);
      });
    }catch(err){
      statusEl.textContent = 'Error al crear consulta: ' + err.message;
      console.error(err);
    }
  </script>
</body>
</html> 

